<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tandem Infrastructure Self-Service</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="/infra-self-service/css/styles.css" />
  </head>
  <body>
    <!-- Header -->
    <header class="site-header">
      <div class="header-container">
        <img src="/docs/assets/tandem-logo.png" alt="Tandem Diabetes Care Logo" class="header-logo" />
        <h1 class="header-title">Tandem Internal Tools</h1>
      </div>
    </header>

    <!-- Main app header -->
    <div class="app-header">
      <div class="app-header-container">
        <div class="app-info">
          <h1>Infrastructure Self-Service Portal</h1>
          <p class="app-description">Create and manage infrastructure resources</p>
        </div>
        <div class="user-info">
          <span id="username">Authenticated User</span>
          <button id="logout-button">Logout</button>
        </div>
      </div>
    </div>

    <!-- Main content -->
    <main class="main-content">
      <div class="page-controls">
        <div class="search-box">
          <input type="text" placeholder="Search resources..." id="resource-search">
        </div>
        <div class="view-controls">
          <button class="view-button active" data-view="grid">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="7" height="7"></rect>
              <rect x="14" y="3" width="7" height="7"></rect>
              <rect x="14" y="14" width="7" height="7"></rect>
              <rect x="3" y="14" width="7" height="7"></rect>
            </svg>
            Grid
          </button>
          <button class="view-button" data-view="list">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="8" y1="6" x2="21" y2="6"></line>
              <line x1="8" y1="12" x2="21" y2="12"></line>
              <line x1="8" y1="18" x2="21" y2="18"></line>
              <line x1="3" y1="6" x2="3.01" y2="6"></line>
              <line x1="3" y1="12" x2="3.01" y2="12"></line>
              <line x1="3" y1="18" x2="3.01" y2="18"></line>
            </svg>
            List
          </button>
        </div>
      </div>

      <div class="resources-container grid-view" id="resources-container">
        <!-- Page 1 -->
        <div class="resource-page active" data-page="1">
          <div class="resource-card">
            <h3>Virtual Machines</h3>
            <p>Deploy and configure virtual machines with predefined templates.</p>
            <button class="resource-button" data-resource="vm">Create VM</button>
          </div>
          
          <div class="resource-card">
            <h3>Storage Accounts</h3>
            <p>Create and manage storage accounts for your application data.</p>
            <button class="resource-button" data-resource="storage">Create Storage</button>
          </div>
          
          <div class="resource-card">
            <h3>Service Bus</h3>
            <p>Set up messaging services for your applications.</p>
            <button class="resource-button" data-resource="servicebus">Create Service Bus</button>
          </div>
          
          <div class="resource-card">
            <h3>Kubernetes Clusters</h3>
            <p>Deploy and manage containerized applications at scale.</p>
            <button class="resource-button" data-resource="kubernetes">Create Cluster</button>
          </div>
        </div>
        
        <!-- Page 2 -->
        <div class="resource-page" data-page="2">
          <div class="resource-card">
            <h3>API Management</h3>
            <p>Create and publish APIs for developers and partners.</p>
            <button class="resource-button" data-resource="apim">Create API</button>
          </div>
          
          <div class="resource-card">
            <h3>SQL Databases</h3>
            <p>Set up and configure SQL databases for your applications.</p>
            <button class="resource-button" data-resource="sql">Create Database</button>
          </div>
          
          <div class="resource-card">
            <h3>Web Apps</h3>
            <p>Deploy and host web applications quickly and easily.</p>
            <button class="resource-button" data-resource="webapp">Create Web App</button>
          </div>
          
          <div class="resource-card">
            <h3>Function Apps</h3>
            <p>Build serverless applications with event-driven code.</p>
            <button class="resource-button" data-resource="function">Create Function</button>
          </div>
        </div>
      </div>
      
      <div class="pagination">
        <button class="page-button active" data-page="1">1</button>
        <button class="page-button" data-page="2">2</button>
      </div>

      <div id="loading" style="display: none">
        <div class="loader"></div>
      </div>

      <div id="resource-form-container" style="display: none">
        <div class="form-header">
          <h2 id="form-title">Create Resource</h2>
          <button id="close-form" class="close-button">&times;</button>
        </div>
        <form id="resource-form">
          <div id="form-fields">
            <!-- Form fields will be loaded here based on resource type -->
          </div>
          <div id="environment-selector"></div>
          <div class="form-actions">
            <button type="button" id="cancel-form">Cancel</button>
            <button type="submit" id="submit-form">Submit Request</button>
          </div>
        </form>
      </div>

      <div id="result-message"></div>
    </main>

    <!-- Footer -->
    <footer class="site-footer">
      <div class="footer-container">
        <p>&copy; 2025 Tandem Diabetes Care. All rights reserved.</p>
        <div class="footer-links">
          <a href="#">Privacy Policy</a>
          <a href="#">Terms of Service</a>
          <a href="#">Contact Support</a>
        </div>
      </div>
    </footer>

    <script src="/infra-self-service/js/service-bus-form.js"></script>
    <script src="/infra-self-service/js/servicebus-api.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>

    <script>
      // Check if user is logged in
      document.addEventListener("DOMContentLoaded", function() {
        const token = sessionStorage.getItem("github_token");
        if (!token) {
          // Redirect to login page if no token
          window.location.href = "/infra-self-service/index.html";
        }
      });

      // Logout button handler
      document.getElementById("logout-button").addEventListener("click", function() {
        sessionStorage.removeItem("github_token");
        window.location.href = "/infra-self-service/index.html";
      });

      // Switch between grid and list views
      document.querySelectorAll('.view-button').forEach(button => {
        button.addEventListener('click', function() {
          document.querySelectorAll('.view-button').forEach(btn => btn.classList.remove('active'));
          this.classList.add('active');
          
          const view = this.getAttribute('data-view');
          const container = document.getElementById('resources-container');
          
          if (view === 'grid') {
            container.classList.remove('list-view');
            container.classList.add('grid-view');
          } else {
            container.classList.remove('grid-view');
            container.classList.add('list-view');
          }
        });
      });

      // Pagination functionality
      document.querySelectorAll('.page-button').forEach(button => {
        button.addEventListener('click', function() {
          const pageNumber = this.getAttribute('data-page');
          
          // Update active page button
          document.querySelectorAll('.page-button').forEach(btn => btn.classList.remove('active'));
          this.classList.add('active');
          
          // Show active page
          document.querySelectorAll('.resource-page').forEach(page => {
            page.classList.remove('active');
            if (page.getAttribute('data-page') === pageNumber) {
              page.classList.add('active');
            }
          });
          
          // Scroll to top of resource container
          document.getElementById('resources-container').scrollIntoView({ behavior: 'smooth', block: 'start' });
        });
      });

      // Resource search functionality
      document.getElementById('resource-search').addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase();
        const resourceCards = document.querySelectorAll('.resource-card');
        
        resourceCards.forEach(card => {
          const title = card.querySelector('h3').textContent.toLowerCase();
          const description = card.querySelector('p').textContent.toLowerCase();
          
          if (title.includes(searchTerm) || description.includes(searchTerm)) {
            card.style.display = 'block';
          } else {
            card.style.display = 'none';
          }
        });
      });

      // Resource buttons functionality
      document.querySelectorAll(".resource-button").forEach(button => {
        button.addEventListener("click", function() {
          const resourceType = this.parentElement.querySelector("h3").textContent;
          document.getElementById("form-title").textContent = `Create ${resourceType}`;
          
          // Clear previous form fields
          document.getElementById("form-fields").innerHTML = "";
          
          // Load form fields based on resource type
          const resourceId = this.getAttribute('data-resource');
          loadFormFields(resourceId);
          
          // Show form container
          document.getElementById("resource-form-container").style.display = "block";
          document.getElementById("resource-form-container").scrollIntoView({ behavior: "smooth" });
        });
      });

      // Function to load form fields based on resource type
      function loadFormFields(resourceId) {
        const formFields = document.getElementById("form-fields");
        
        // Clear existing fields
        formFields.innerHTML = "";
        
        // Common fields for all resources
        const nameField = createFormField('name', 'Name', 'text', 'Enter a name for this resource');
        formFields.appendChild(nameField);
        
        // Resource-specific fields
        switch(resourceId) {
          case 'vm':
            formFields.appendChild(createFormField('size', 'VM Size', 'select', '', [
              { value: 'small', text: 'Small (2 vCPU, 4GB RAM)' },
              { value: 'medium', text: 'Medium (4 vCPU, 8GB RAM)' },
              { value: 'large', text: 'Large (8 vCPU, 16GB RAM)' }
            ]));
            formFields.appendChild(createFormField('os', 'Operating System', 'select', '', [
              { value: 'windows', text: 'Windows Server 2022' },
              { value: 'ubuntu', text: 'Ubuntu 22.04 LTS' },
              { value: 'rhel', text: 'Red Hat Enterprise Linux 9' }
            ]));
            break;
            
          case 'storage':
            formFields.appendChild(createFormField('type', 'Storage Type', 'select', '', [
              { value: 'blob', text: 'Blob Storage' },
              { value: 'file', text: 'File Storage' },
              { value: 'table', text: 'Table Storage' }
            ]));
            formFields.appendChild(createFormField('replication', 'Replication', 'select', '', [
              { value: 'lrs', text: 'Locally Redundant Storage (LRS)' },
              { value: 'zrs', text: 'Zone Redundant Storage (ZRS)' },
              { value: 'grs', text: 'Geo-Redundant Storage (GRS)' }
            ]));
            break;
            
          case 'servicebus':
            formFields.appendChild(createFormField('tier', 'Service Tier', 'select', '', [
              { value: 'basic', text: 'Basic' },
              { value: 'standard', text: 'Standard' },
              { value: 'premium', text: 'Premium' }
            ]));
            formFields.appendChild(createFormField('topic', 'Topic Name', 'text', 'Enter the main topic name'));
            formFields.appendChild(createFormField('subscription', 'Subscription Name', 'text', 'Enter the subscription name'));
            break;
        }
        
        // Add environment selector for all resources
        const environmentSelector = document.getElementById("environment-selector");
        environmentSelector.innerHTML = `
          <h3>Deployment Environment</h3>
          <div class="form-group">
            <label for="environment">Select Environment</label>
            <select id="environment" name="environment" required>
              <option value="dev">Development</option>
              <option value="test">Test</option>
              <option value="staging">Staging</option>
              <option value="prod">Production</option>
            </select>
          </div>
          <div class="approval-info">
            <p>Note: Production deployments require manager approval.</p>
          </div>
        `;
      }

      // Helper function to create form fields
      function createFormField(id, label, type, placeholder, options = []) {
        const fieldDiv = document.createElement('div');
        fieldDiv.className = 'form-group';
        
        const fieldLabel = document.createElement('label');
        fieldLabel.setAttribute('for', id);
        fieldLabel.textContent = label;
        fieldDiv.appendChild(fieldLabel);
        
        if (type === 'select') {
          const select = document.createElement('select');
          select.id = id;
          select.name = id;
          select.required = true;
          
          options.forEach(option => {
            const optionElement = document.createElement('option');
            optionElement.value = option.value;
            optionElement.textContent = option.text;
            select.appendChild(optionElement);
          });
          
          fieldDiv.appendChild(select);
        } else {
          const input = document.createElement('input');
          input.type = type;
          input.id = id;
          input.name = id;
          input.placeholder = placeholder;
          input.required = true;
          fieldDiv.appendChild(input);
        }
        
        return fieldDiv;
      }

      // Close and cancel form buttons
      document.getElementById("close-form").addEventListener("click", function() {
        document.getElementById("resource-form-container").style.display = "none";
      });

      document.getElementById("cancel-form").addEventListener("click", function() {
        document.getElementById("resource-form-container").style.display = "none";
      });

      // Form submission
      document.getElementById("resource-form").addEventListener("submit", function(event) {
        event.preventDefault();
        
        // Show loading indicator
        document.getElementById("loading").style.display = "flex";
        document.getElementById("resource-form-container").style.display = "none";
        
        // Simulate form submission (replace with actual API call)
        setTimeout(function() {
          document.getElementById("loading").style.display = "none";
          document.getElementById("result-message").innerHTML = `
            <div class="success-message">
              <h3>Resource Created Successfully</h3>
              <p>Your resource has been submitted for provisioning. You will be notified when it is ready.</p>
            </div>
          `;
          
          // Scroll to result message
          document.getElementById("result-message").scrollIntoView({ behavior: "smooth" });
        }, 2000);
      });
    </script>
  </body>
</html>